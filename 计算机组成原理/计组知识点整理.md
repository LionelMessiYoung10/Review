#### 计组知识点整理

- 1946年第一台电子计算机 `ENIAC`
- 冯诺依曼设计思想
  - 二进制表示
  - 存储程序
- 控制器可以区分指令还是数据
- 机器字长：CPU一次能处理的二进制数据的最大位数，与CPU的**寄存器位数**有关系。
- 存储字长：一个存储单元可以存放的二进制代码的位数，就是存储器中MDR的位数。
- CPU运算速度
  - 吞吐量
  - 响应时间
  - 主频
  - 时钟周期
  - CPU执行时间
  - CPI  时钟周期数
  - MIPS  每秒执行多少百万条指令
  - FLOPS 每秒执行多少浮点运算
- 常用的名词
  - `CPU`：Central Processing Unit 中央处理机，运算器和控制器组成
  - `PC` ：Program Counter 程序计数器，其功能是存放当前欲执行指令的地址，并可自动计数 形成下一条指令地址。
  - `IR`：Instruction Register 指令寄存器，其功能是存放当前正在执行的指令。
  - `CU`：Control Unit 控制单元 为控制器的核心部件，其功能是产生微操作命令序列。
  - `ALU`：Arithmetic Logic Unit，算术逻辑运算单元，为运算器的核心部件，其功能是进行算术、逻辑运算。
  - `ACC`：Accumulator 累加器 是运算器中既能存放运算前的操作数，又能存放运算结果的寄存器。
  - `MQ`：Multiplier-Quotient Register 乘商寄存器，乘法运算时存放乘数、除法时存放商的寄存器。
  - `MAR`：Memory Address Register ，存储器地址寄存器，在主存中用来存放欲访问的存储单元的地址。
  - `MDR`： Memory Data Register ，存储器数据缓冲寄存器，在主存中用来存放从某单元读出、或要写入某存储单元的数据。
- 计算机系统由 硬件系统 和 软件系统 组成
- 计算机的软件可以分为 应用软件 和 系统软件
- 总线可以分为片内总线、系统总线和通信总线
- 串行总线比并行总线传输快
- `PCI-Expressx16` 是串行传输
- 典型的总线标准：`ISA`、`EISA`、`VESA`、`PCI`、`PCI-Express`、`AGP`、`USB`、`RS-232C`
- 总线宽度：可以同时传输的数据的位数，跟数据线条数有关系
- 总线宽度=数据总线
- 总线的传输速率为总线的工作频率乘以总线宽度
- 集中式总线控制中，响应时间最快的是 独立请求 它是以增加处理器开销和控制线的数量为代价
- 链式查询方式对电路故障最敏感
- 分布式仲裁逻辑分散在总线各部件中
- 连接计算机和计算机之间的总线是 通信总线
- 系统总线中的xxx线，是根据总线传输的内容确定的
- 总线传输时间=总线传输周期 $\div$ 总线时钟频率
- 总线传输率 = 总线宽度 $\div$ 总线传输时间 = 总线宽度 $\times$ 总线工作频率
- 总线特征：电气特征、机械特征、时间特征。
- 计数器查询优先级判别方式中各个设备共用一条总线请求线。
- `RAM`是易失性存储器 `ROM`是非易失性存储器 都采用随机存取方式进行信息访问
- `CDROM` 不采用随机存取方式 采用串行处理方式
- `FlashMemory` 可读可写，但是读比写快
- `SDRAM` 需要周期性刷新 D是`Dynamic`
- 相联存储器根据存储器内容来存取
- `MAR` 的位数对应存储单元的个数，主存地址空间相关，但是和实际大小无关
- 存储器用于存放数据和程序
- 主存 容量小、速度快、成本高
- `DRAM` 刷新一次刷新一行
- 存储器带宽 = (总线频率$\times$数据位宽) $\div$ 8
- 特殊记忆 周期`200ns` = 频率 `5MHz`
- 虚拟存储器的主要目的是扩大主存的存储空间
- 采用指令`cache`与数据`cache` 分离的主要目的是减少指令流水线资源的冲突
- 多体交叉存储器是为了提高数据传输率
- `cache`的功能全是由硬件实现
- `cache`块被替换出时需要对主存执行写操作
- 计算机的存储器采用分级存储器体系的主要目的是解决存储容量、价格和存取速度之间的矛盾。
- cache替换策略
  - FIFO没特点
  - LRU 近期最小使用  命中率高
  - 随机替换  快
- cache的三种映射
  - 全相联映射：成本搞、利用率高
  - 直接相连：固定位置、命中率低
  - 组相连：他俩的折中
- 计算机外部设备指 IO设备和外部存储器
- 各种外设需要通过I/O接口电路才能连接到系统总线上
- DMA方式在与外部设备的数据传输方式中依赖硬件的数据
- 一条指令结束，不发中断请求，可以发中断响应
- 中断服务程序的最后一条指令是中断返回指令
- 具有中断向量表的计算机系统，中断向量地址是中断服务程序入口地址的地址
- 中断屏蔽字 暂停对某些中断源的处理
- 外部设备发送DMA请求
- 中断允许触发器 可以禁止中断
- DMA中，周期挪用是外部设备挪用或窃取总线占用权一个或多个 主存周期
- 中断隐指令：关中断、保护程序断点、寻找中断服务程序的入口地址
- 中断屏蔽字中 1表示不可被中断 0表示可被中断
- 计算机用无符号数表示内存单元地址
- 0编码在原码、反码有2种，补码1种
- 运算器由：ALU、累加器、状态寄存器、通用寄存器等组成
- 定点机中执行算术运算时产生溢出的原因时 运算结果无法表示
- 若浮点数用补码形式表示，尾数符号位与小数点后第一位相异，是规格化浮点数
- 浮点数的范围由阶码决定，精度由尾数决定
- 基数在机器数中不出现
- 规格化浮点数，其他不变，将阶码部分的移码表示改为补码后，数的表示范围不变
- 双符号01是正溢，10是负溢
- 运算器 = ALU = 算术逻辑单元
- 浮点数操作指标 MFLOPS
- 寻址方式
  - 不同寻址方式为了缩短指令长度、扩大寻址空间、提高编程灵活性
  - 立即寻址：操作数在指令中
  - 寄存器寻址：操作上在指令中的寄存器中
  - 直接寻址：操作数所在存储器的有效地址在指令中
  - 寄存器间接寻址：操作数所在存储器的有效地址在指令中的寄存器中
  - 寄存器先对寻址：操作数所在存储器的有效地址为指令中的寄存器加位移量
  - 基址变址寻址：操作数所在存储器的有效地址为指令中的基址寄存器加变址寄存器
  - 相对基址变址寻址：操作数所在存储器的有效地址为指令中的基址寄存器加变址寄存器再加位移量
- 相对寻址、变址寻址需要先计算在访问主存
- 变址寻址适合按下标顺序访问一维数组
- 指令
  - 零地址指令
    - $OP$
    - 不需要操作数，如空操作、关机等
    - 堆栈计算机
  - 一地址指令
    - $OP$ $A_1$
    - 只需要单操作数，+1、-1、~等
      - $OP(A_1) \longrightarrow A_1$  
        - 这个需要3次访存：取 读 写
    - 需要两个操作数，但其中一个操作数隐含再某个寄存器中
      - $(ACC)OP(A_1) \longrightarrow ACC$ 
        - 2次访存：取 读
    - $A_1$ 是指某个主存的地址，$(A_1)$ 是指 $A_1$ 指向的地址的内容
  - 二地址指令
    - $OP$ $A_1(目的操作数)$ $A_2(源操作数)$
    - 常用于需要两个操作数的算术运算、逻辑运算
      - $(A_1)OP(A_2) \longrightarrow A_1$
        - 4次访存，取 读A1 读A2 写A1
  - 三地址
    - $OP$ $A_1$ $A_2$ $A_3(结果)$
    - 常用于需要两个操作数的算术运算、逻辑运算相关指令
      - $(A_1)OP(A_2) \longrightarrow A_3$
        - 4次访存，取 读A1 读A2 写A3
  - 四地址
    - $OP$ $A_1$ $A_2$ $A_3(结果)$ $A_4(下址)$
      - $(A_1)OP(A_2) \longrightarrow A_3$ $A_4$ = 下一条将要执行指令的地址
        - 4次访存：取 读A1 读A2 写A3
  - 正常情况下：取指令之后 PC+1，指向下一条指令
  - 四地址指令：执行指令后，将PC的值修改为$A_4$所指的地址
  - ![](https://img-blog.csdnimg.cn/a9eb385d523349c693c68809dd0a48ec.png)
- 从操作数的物理位置来说，可把二地址指令：
  - 存储器-存储器（SS）型指令：参与操作的数都放在内存里,从内存某
    单元中取操作数,操作结果存放至内存另一单元中
  - 寄存器-寄存器（RR）型指令：需要多个通用寄存器或个别专用寄存
    器,从寄存器中取操作数,把操作结果放到另一寄存器中.
  - 寄存器-存储器（RS）型指令：执行此类指令,既要访问内存单元,
    又要访问寄存器
- 在各种寻址方式中，指令的地址码字段可能有：寄存器编号，设备端口地址、存储器的单元地址、数值
- 指令寄存器IR的位数 = 指令长度 IR对应的是指令的宽度
- PC对应的是指令的数量
  - 如果存储字长=指令字长 PC的位数对应于存储的容量 = 地址线的长度
  - 如指令字长是存储字长的n倍，PC的位数=存储的容量$\div$n
- RISC 大部分指令在一个机器周期内完成 通用寄存器的数量多
- 寄存器堆栈：硬堆栈 栈顶是固定的
- 存储器堆栈：软堆栈 堆栈的大小可以改变，栈底固定，栈顶浮动
- 堆栈的栈底地址大于栈顶地址
  - 入栈：$(SP)-1 \longrightarrow SP$         $(A) \longrightarrow (SP)$
  - 出栈：$((SP)) \longrightarrow A$         $(SP) + 1 \longrightarrow SP$
- 指令字长跟机器字长没关系
- 指令字长一般是存储字长的整数倍，是几倍，取指周期就是机器周期的几倍
- 反汇编语言程序员可见 PC程序计数器
- CPU流水线堵IR塞
  - 资源冲突：多个任务在同一时间周期内争用同一个流水段
  - 数据相关：数据依赖
  - 条件转移：条件转移的影响
- 控制器： PC，IR，ID(Instruction Decoder)指令译码器，时序产生器、操作控制器
- ID对指令的操作码字段进行译码
- 计算流水线执行时间：$Nt+(k-1)\times t$
- 流水线的吞吐率：任务数$\div$完成时间
- 写指令CPU先执行 $PC \longrightarrow MAR$
- 加法指令的执行周期一定访存
- 一条微指令放在控制存储器CM的一个单元中
- 微指令计数器决定了微指令的执行顺序
- 控制存储器CM由ROM构成
- CM MM
  - CM是主存储器在CPU外面，由RAM和ROM组成，按地址访问，存放指令和数据
  - MM是控制存储器在CPU里面，由ROM构成，按微程序地址访问， 存放微程序
- 组合逻辑控制器和微程序控制器的主要区别在于微操作信号发生器的构成方法不同，前者指令执行快，但是修改和扩展指令功能相对困难，后者慢是因为还得从控制存储器中读取微指令
- 一条机器指令由一段用微指令编写的微程序来执行
- 微程序控制器中，微程序的入口通过指令操作码映射获得
- 水平型微指令：
  - 并行操作能力强，效率高，灵活性强
  - 微指令字较长，微程序短，控存容量大，性能佳
- 垂直性微指令：
  - 字长短，微程序长，控存容量小， 性能差
  - 垂直型与汇编指令相似，易于掌握
  - 基本被淘汰
- 相容性微操作：能够同时或在同一个CPU周期内并行执行的微操作。
- 相斥性微操作：不能同时或在同一个CPU周期内并行执行的微操作

